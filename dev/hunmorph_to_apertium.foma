## Converts the output of ocamorph to the Apertium stream format.
## This script does NOT expect the default ocamorph output format. Instead, run
## ocamorph with the following parameters:
##
##   ./ocamorph --bin morphdb.hu/morphdb_hu.bin --tag_preamble ""
##              --tag_sep $'\t' --blocking --guess Fallback
##
## (Obviously, the points here are the values of the tag_preamble and tag_sep
## parameters.)

# TODO: What to do with /'s in WordForm?
define NonSlash [? - [%/ | "	"]];
define WordForm NonSlash+;
read lexc kr_to_apertium.lexc
define Analysis
define WordInflection WordForm [%/:0 NonSlash:0*]* %/ NonSlash+;
define Converter WordInflection .o. Analysis;

regex [0 : %^] WordForm [ ["	" : %/] Converter ]+ [0 : %$];
save stack h2a.fst
